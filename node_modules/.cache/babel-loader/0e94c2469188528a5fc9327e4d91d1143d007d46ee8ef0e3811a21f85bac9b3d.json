{"ast":null,"code":"'use strict';\n\nmodule.exports = function (movie, year, multi, cb) {\n  var search = {\n    key: '9d2bff12ed955c7f1f74b83187f188ae',\n    protocol: require('https'),\n    cb: cb,\n    id: null,\n    year: null,\n    multi: multi,\n    movie: movie,\n    options: {\n      host: 'api.themoviedb.org',\n      port: 443,\n      path: null\n    }\n  };\n  if (typeof year === 'function') {\n    search.cb = year;\n    year = multi = null;\n  } else if (typeof multi === 'function') {\n    search.cb = multi;\n    multi = false;\n  }\n  if (typeof movie !== 'string') {\n    throw new Error('Expected a string');\n  } else {\n    search.year = year;\n    getConfig(search);\n  }\n};\nfunction getConfig(search) {\n  var data = '';\n  search.options.path = encodeURI('/3/search/movie?api_key=' + search.key + '&query=' + search.movie + (search.year !== null ? '&year=' + search.year : ''));\n  search.protocol.get(search.options, function (resp) {\n    resp.on('data', function (chunk) {\n      data += chunk;\n    });\n    resp.on('end', function () {\n      var json = JSON.parse(data);\n      if (typeof json.status_message !== 'undefined') {\n        search.cb('Got error: ' + json.status_message);\n      } else if (json.results.length === 0) {\n        // Retry failed search without year\n        if (search.year !== null) {\n          search.year = null;\n          getConfig(search);\n        } else {\n          search.cb('Got error: ' + 'No results found');\n        }\n      } else {\n        search.mid = json.results[0].id;\n        getMovie(search);\n      }\n    });\n  }).on(\"error\", function (e) {\n    search.cb('Got error: ' + e.message);\n  });\n}\nfunction getMovie(search) {\n  var data = '';\n  search.options.path = encodeURI('/3/movie/' + search.mid + '/videos?api_key=' + search.key);\n  search.protocol.get(search.options, function (resp) {\n    resp.on('data', function (chunk) {\n      data += chunk;\n    });\n    resp.on('end', function () {\n      var json = JSON.parse(data);\n      if (typeof json.status_message !== 'undefined') {\n        search.cb('Got error: ' + json.status_message);\n      } else if (json.results.length === 0) {\n        search.cb('Got error: ' + 'No results found');\n      } else if (search.multi) {\n        search.cb(null, json.results);\n      } else {\n        var youtube = json.results.filter(function (obj) {\n          return obj.site.toLowerCase() === \"youtube\";\n        });\n        search.cb(null, encodeURI('https://www.youtube.com/watch?v=' + json.results[0].key));\n      }\n    });\n  }).on(\"error\", function (e) {\n    search.cb('Got error: ' + e.message);\n  });\n}","map":{"version":3,"names":["module","exports","movie","year","multi","cb","search","key","protocol","require","id","options","host","port","path","Error","getConfig","data","encodeURI","get","resp","on","chunk","json","JSON","parse","status_message","results","length","mid","getMovie","e","message","youtube","filter","obj","site","toLowerCase"],"sources":["/Users/shanashly/Projects/netflix-clone/node_modules/movie-trailer/index.js"],"sourcesContent":["'use strict';\nmodule.exports = function (movie, year, multi, cb) {\n\tvar search = {\n\t\tkey: '9d2bff12ed955c7f1f74b83187f188ae',\n\t\tprotocol: require('https'),\n\t\tcb: cb,\n\t\tid: null,\n\t\tyear: null,\n\t\tmulti: multi,\n\t\tmovie: movie,\n\t\toptions: {\n\t\t\thost: 'api.themoviedb.org',\n\t\t\tport: 443,\n\t\t\tpath: null\n\t\t}\n\t}\n\t\n\tif (typeof year === 'function') {\n\t\tsearch.cb = year;\n\t\tyear = multi = null;\n\t} else if (typeof multi === 'function') {\n\t\tsearch.cb = multi;\n\t\tmulti = false;\n\t}\n\tif (typeof movie !== 'string') {\n\t\tthrow new Error('Expected a string');\n\t} else {\n\t\tsearch.year = year;\n\t\tgetConfig(search);\n\t}\n};\n\nfunction getConfig (search) {\n\tvar data = '';\n\tsearch.options.path = encodeURI('/3/search/movie?api_key=' + search.key + '&query=' + search.movie + ((search.year !== null) ? '&year='+search.year : ''));\n\tsearch.protocol.get(search.options, function(resp){\n\t  resp.on('data', function(chunk){\n\t\tdata += chunk;\n\t  });\n\t  resp.on('end', function(){\n\t\tvar json = JSON.parse(data);\n\t\tif (typeof(json.status_message) !== 'undefined'){\n\t\t\tsearch.cb('Got error: ' + json.status_message);\n\t\t} else if (json.results.length === 0){\n\t\t\t// Retry failed search without year\n\t\t\tif(search.year !== null){\n\t\t\t\tsearch.year = null;\n\t\t\t\tgetConfig(search);\n\t\t\t} else {\n\t\t\t\tsearch.cb('Got error: ' + 'No results found');\n\t\t\t}\n\t\t} else {\n\t\t\tsearch.mid = json.results[0].id;\n\t\t\tgetMovie(search);\n\t\t}\n\t  });\n\t}).on(\"error\", function(e){\n\t\tsearch.cb('Got error: ' + e.message);\n\t});\n}\n\nfunction getMovie(search) {\n\tvar data = '';\n\tsearch.options.path = encodeURI('/3/movie/'+ search.mid + '/videos?api_key=' + search.key);\n\tsearch.protocol.get(search.options, function(resp){\n\t  resp.on('data', function(chunk){\n\t\tdata += chunk;\n\t  });\n\t  resp.on('end', function(){\n\t\tvar json = JSON.parse(data);\n\t\tif (typeof(json.status_message) !== 'undefined'){\n\t\t\tsearch.cb('Got error: ' + json.status_message);\n\t\t} else if (json.results.length === 0){\n\t\t\tsearch.cb('Got error: ' + 'No results found')\n\t\t} else if(search.multi){\n\t\t\tsearch.cb(null, json.results);\n\t\t} else {\n\t\t\tvar youtube = json.results.filter(function(obj) {\n\t\t\t    return (obj.site.toLowerCase() === \"youtube\");\n\t\t\t});\n\t\t\tsearch.cb(null, encodeURI('https://www.youtube.com/watch?v=' + json.results[0].key));\n\t\t}\n\t  });\n\t}).on(\"error\", function(e){\n\t\tsearch.cb('Got error: ' + e.message);\n\t});\n}"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}